<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Polemic</title>
        <description></description>      
        <link>https://polemic.nz</link>
        <atom:link href="https://polemic.nz/feed.xml" rel="self" type="application/rss+xml" />
        
            <item>
                <title>FOSS4G / QGIS Geometry Generators</title>
                <description>&lt;p&gt;Last week I was fortunate to attend and present at FOSS4G SOTM&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; Oceania. 
The conference, now in it&amp;#39;s second year, brings together Open Source developers &amp;amp; users in GIS, as well
as the Oceania OpenStreetMap communities, for a total of 4 days of workshops, talks and community events.&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;tl&quot; dir=&quot;ltr&quot;&gt;Hooorraayy &lt;a href=&quot;https://t.co/PmlNzJ5TTb&quot;&gt;pic.twitter.com/PmlNzJ5TTb&lt;/a&gt;&lt;/p&gt;&amp;mdash; FOSS4G SotM Oceania (@FOSS4G_Oceania) &lt;a href=&quot;https://twitter.com/FOSS4G_Oceania/status/1195116972314218496?ref_src=twsrc%5Etfw&quot;&gt;November 14, 2019&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;Durign the lightening talk session I gave a brief introduction to QGIS Geometry Generators. I&amp;#39;ve had a few requests for more detail on the techniques covered.&lt;/p&gt;

&lt;h3&gt;What is a Geometry Generator&lt;/h3&gt;

&lt;p&gt;A Geometry Generator is a symbol layer type that lets you use code to create new geometries from existing features, and use the new &amp;#39;generated&amp;#39; geometries as symbols that can, in turn, have styles applied.&lt;/p&gt;

&lt;p&gt;This is a powerful feature best explained with an example.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note that many of these generators rely on functions released in version 3.10, and I recommend you upgrade your QGIS version if you haven&amp;#39;t done so already!&lt;/strong&gt;&lt;/p&gt;

&lt;h3&gt;Creating a Buffer&lt;/h3&gt;

&lt;p&gt;Let&amp;#39;s say we have a simple points layer, like so:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-points.png&quot; alt=&quot;A Basic Points Dataset&quot;&gt;&lt;/p&gt;

&lt;p&gt;We can open the layer symbology and select a &amp;quot;Geometry Generator&amp;quot; style layer with a simple expression&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;buffer($geometry, 100)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-points-buffer-gen.png&quot; alt=&quot;Simple Buffer Generator&quot;&gt;&lt;/p&gt;

&lt;p&gt;It&amp;#39;s important to note the &amp;quot;Geometry Type&amp;quot; option here - it mush match the output of the expression. In
this case, the input is a point layer, and the &lt;code&gt;buffer&lt;/code&gt; generates a 100m buffered polygon for each feature
geometry referred to by the variable &lt;code&gt;$geometry&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The result is what you might expect:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-points-buffered.png&quot; alt=&quot;A Basic Points Dataset buffered by 100m&quot;&gt;&lt;/p&gt;

&lt;p&gt;So far not very exciting. You could have just used a standard marker symbol with a radius of 50 metres at scale, for example. Except to note that this buffer will be correctly projected over larger scales, and that
this can be applied to any type of geometry - lines, points or polygons, to give the same effect.&lt;/p&gt;

&lt;h3&gt;Using Built-in Variables&lt;/h3&gt;

&lt;p&gt;Now we&amp;#39;ll add a second symbol to the same points layer, this time it&amp;#39;s generating lines with an &amp;quot;arrow&amp;quot; symbol attached. I&amp;#39;ll show the code, the result, and walk through what&amp;#39;s happening:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;difference(
    make_line(
        $geometry,
        @map_extent_center
    ),
    make_circle(
        @map_extent_center,
        250
    )
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-points-arrows.png&quot; alt=&quot;Points with an additional lines symbol to the centre of the map&quot;&gt;&lt;/p&gt;

&lt;p&gt;We have a number of built-in variables at our displosal. Some, like &lt;code&gt;$area&lt;/code&gt; refer to the current feature. Others, like &lt;code&gt;@map_extent_center&lt;/code&gt; refer to the state of the displayed map.&lt;/p&gt;

&lt;p&gt;This expression is using &lt;code&gt;make_line&lt;/code&gt; to generate a line from the current feature to the centre of the current
map view. Since all of our lines would converge at the map centre, I&amp;#39;m also using &lt;code&gt;create_circle&lt;/code&gt; to generate a 250m circular &amp;#39;mask&amp;#39; at the centre of the map and using &lt;code&gt;difference&lt;/code&gt; to clip the line. The result is a series of arrows originating at our points, terminating 250m from the centre of the map.&lt;/p&gt;

&lt;h4&gt;Adding Randomness&lt;/h4&gt;

&lt;p&gt;Given a lines layer like so:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines.png&quot; alt=&quot;Simple lines layer&quot;&gt;&lt;/p&gt;

&lt;p&gt;We can modify the geometry of the lines in other interesting ways using simple maths functions available
to all expressions, and by using &lt;code&gt;array_foreach&lt;/code&gt; and &lt;code&gt;generate_series&lt;/code&gt; to iterate over sequences.&lt;/p&gt;

&lt;p&gt;In this example, the &lt;code&gt;array_foreach&lt;/code&gt; returns an array of points, where each point is an interpolated point
every 100m along the line, translated randomly by up to 10m vertically or horizontally. &lt;code&gt;make_line&lt;/code&gt; then
combines the array of points back into a line.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;make_line(
    array_foreach(
        generate_series(
            0, length($geometry), 100
        ),
        translate(
            line_interpolate_point($geometry, @element),
            rand(-10, 10),
            rand(-10, 10)
        )
    )
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The result is a degree of randomness added to the output symbol:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines-randomness.png&quot; alt=&quot;Simple lines layer with randomness&quot;&gt;&lt;/p&gt;

&lt;p&gt;Duplicating the symbol along with the original style can give the symbol a hand-drawn effect:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines-randomness-multiple.png&quot; alt=&quot;Lines with mutliple randomised symbols giving a drawn effect&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines-sketch.png&quot; alt=&quot;A real roads dataset with a sketch effect&quot;&gt;&lt;/p&gt;

&lt;p&gt;A variant of the approach where each interpolated point is randomly sprinkled with &amp;#39;sparks&amp;#39; - 
a fun way to symbolise &lt;a href=&quot;https://data.linz.govt.nz/layer/50219-nz-powerline-centrelines-topo-1500k/&quot;&gt;Transmission Lines&lt;/a&gt; from LINZ, for example:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines-electric.png&quot; alt=&quot;A real roads dataset with a sketch effect&quot;&gt;&lt;/p&gt;

&lt;h3&gt;Offsets and Fancier Markup&lt;/h3&gt;

&lt;p&gt;In this example, the &lt;code&gt;line_substring&lt;/code&gt; expression is building a set of new lines for each inner vertex
each feature – that is, for each &lt;em&gt;angle&lt;/em&gt; in the line, it construct a simple 3-vertex line starting 100m
before and ending 100m after the inner vertex. The &lt;code&gt;offset_curve&lt;/code&gt; function creates a rounded version of the
new lines, offset 75m to one side of the original location. &lt;code&gt;collect_geometries&lt;/code&gt; turns the array of lines
into a single MultiLine for rendering.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;collect_geometries(
    array_foreach(
        generate_series(2, num_points($geometry) - 1),
        offset_curve(
            line_substring(
                $geometry,
                 distance_to_vertex(
                    $geometry,
                    @element - 1
                ) - 100,
                distance_to_vertex(
                    $geometry,
                    @element - 1
                ) + 100
            ),
            - 75
        )
    )
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Adding a arrow marker symbol at the end of the generated line gives:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-lines-offset-arrows.png&quot; alt=&quot;Lines layer with offset arrows&quot;&gt;&lt;/p&gt;

&lt;h3&gt;A Beautiful Raster Hack&lt;/h3&gt;

&lt;p&gt;This technique was first documented and shared by &lt;a href=&quot;https://twitter.com/cartocalypse&quot;&gt;@cartocalypse&lt;/a&gt; on their &lt;a href=&quot;https://hannes.enjoys.it/blog/2019/09/dynamic-elevation-profile-lines-as-qgis-geometry-generator/&quot;&gt;blog here&lt;/a&gt;. I recommend you read that post for more background.&lt;/p&gt;

&lt;p&gt;Firstly create an &lt;em&gt;empty&lt;/em&gt; polygon layer. A new scratch layer with the &amp;quot;Polygon / CurvePolygon&amp;quot; geometry type will do.&lt;/p&gt;

&lt;p&gt;Secondly set the symbology type to &amp;quot;Inverted Polygon&amp;quot;. Why? Because this will generate a &lt;em&gt;single&lt;/em&gt; feature for the map extent not covered by polygons in the current layer. And since there are &lt;strong&gt;no&lt;/strong&gt; polygons the &amp;quot;inverted polygons&amp;quot; symbol gifts us a single feature that covers the extent of the map. Wonderful!&lt;/p&gt;

&lt;p&gt;Thirdly you&amp;#39;ll need a raster dataset. In this example I use the &lt;a href=&quot;https://data.linz.govt.nz/layer/51768-nz-8m-digital-elevation-model-2012/&quot;&gt;New Zealand 8m DEM&lt;/a&gt; avaialble from LINZ. This layer expresses modelled height from sea-level for the extent of mainland New Zealand.&lt;/p&gt;

&lt;p&gt;Finally configure a Geometry Generator symbol for the layer. In my version below I&amp;#39;ve generated a 40 by
40 cell grid and read the raster value (i.e. elevation). I&amp;#39;ve used the raster value to create circles scaled
to the elevation value:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;with_variable(
    'raster_layer',
    '8m_DEM_ccdf4eaf_1948_423d_a50a_bfdc20912825',       
    collect_geometries(
        array_foreach(
            generate_series(
                y(@map_extent_center)-(@map_extent_height/2), 
                y(@map_extent_center)+(@map_extent_height/2),  
                @map_extent_height / 40
            ),
            with_variable(
                'y',
                @element,
                collect_geometries(
                    array_foreach(
                        generate_series(
                            x(@map_extent_center)-(@map_extent_width/2),
                            x(@map_extent_center)+(@map_extent_width/2),
                            @map_extent_width / 40
                        ),
                        make_circle(
                            make_point(@element, @y),                           
                            coalesce(
                                raster_value(
                                    @raster_layer,
                                    1,
                                    transform( 
                                        make_point(@element, @y),
                                        @map_crs,
                                        layer_property(@raster_layer,'crs')
                                    )
                                ),
                                0 
                            )*10
                        )
                    )
                )
            )
        )
    )
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The result (using an &lt;em&gt;empty&lt;/em&gt; scratch layer!):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20191118-nz-raster-elev.png&quot; alt=&quot;Generated point symbols from raster values.&quot;&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/images/20191118-nz-raster-elev-large.png&quot;&gt;Download link to a larger version&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;Final Notes&lt;/h3&gt;

&lt;p&gt;Geometry generators are a fun and powerful QGIS feature that extends what you can do with symbols far
beyond standard symbol options. They allow you to do more with the raw geometries of your data, without
creating intermediate layers just for display. Geometry Generators can be tricky to tame, so use the 
&amp;quot;Expression Dialog&amp;quot; accessible  from the (somewhat mysterious) &lt;code&gt;ℇ&lt;/code&gt; button to get assistance and a 
decent function reference. The built-in expressions are only the start - you can also use the full power of
python to create your own functions from scratch by selecting &amp;quot;Function Editor&amp;quot; from the expression dialog.&lt;/p&gt;

&lt;h3&gt;&lt;span id=&quot;footnotes&quot;&gt;Footnotes&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;sup&gt;1.&lt;/sup&gt; Recursively expanded to &lt;em&gt;Free and Open Source for Geospatial Information Systems &amp;amp; State of the Map – Oceania&lt;/em&gt;. Hey, naming things is hard.&lt;/p&gt;
</description>
                <pubDate>Mon, 18 Nov 2019 00:00:00 +1300</pubDate>
                <link>https://polemic.nz/2019/11/18/foss4g-qgis-geometry-generators/</link>
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2019/11/18/foss4g-qgis-geometry-generators/</guid>
            </item>
        
            <item>
                <title>Maungawhau / Mt Eden</title>
                <description>&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Maungawhau&quot;&gt;Maungawhau / Mount Eden&lt;/a&gt; forms the highest point in Auckland City. It has some of the best views over the city and is a prominant feature of the skyline. It erupted roughly 28,000 years through an earlier magma flow generated by &lt;a href=&quot;/2019/04/08/te-kopuke/&quot;&gt;Te Kōpuke&lt;/a&gt;. Like many of Auckland&amp;#39;s scoria cones, it was subjected to various human interferences over the years: a resourvior is built into the northern side, the western side was quarried away, and various buildings have been constructed and since removed from the peak. Fortunately it is now under collective management by Auckland Council and local iwi to preserve it for future generations.&lt;/p&gt;

&lt;h3&gt;Datasources&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz/layer/53405-auckland-lidar-1m-dem-2013/&quot;&gt;Auckland Lidar 1m DEM (2013)&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <pubDate>Thu, 11 Apr 2019 00:00:00 +1200</pubDate>
                <link>https://polemic.nz/2019/04/11/maungawhau/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20190411-Maungawhau_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2019/04/11/maungawhau/</guid>
            </item>
        
            <item>
                <title>Te Kōpuke / Mount Saint John</title>
                <description>&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Mount_Saint_John_(New_Zealand)&quot;&gt;Te Kōpuke / Mt Saint John&lt;/a&gt; is one of Auckland&amp;#39;s many peaks in the Auckland volcanic field, and one of our most underrated cones if you ask me. Unfortunately it is obscured by housing these days, but a look at the Lidar-derived elevation model reveals its exceptionally round scoria cone shape. If you know Auckland&amp;#39;s geography, you might be surprised to learn it is the source of the lava flow that built &lt;a href=&quot;https://en.wikipedia.org/wiki/Meola_Reef&quot;&gt;Meola Reef&lt;/a&gt; in the Waitematā Harbour. Until recently it was thought the reef was formed by the eruption of &lt;a href=&quot;https://en.wikipedia.org/wiki/Te_Tatua-a-Riukiuta&quot;&gt;Te Tatua-a-Riukiuta / Three Kings&lt;/a&gt; but geochemical testing revealed that &lt;a href=&quot;/2019/04/11/maungawhau/&quot;&gt;Maungawhau&lt;/a&gt; had erupted through an earlier lava flow from Te Kōpuke, obscuring it&amp;#39;s true source.&lt;/p&gt;

&lt;h3&gt;Datasources&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz/layer/53405-auckland-lidar-1m-dem-2013/&quot;&gt;Auckland Lidar 1m DEM (2013)&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <pubDate>Mon, 08 Apr 2019 00:00:00 +1200</pubDate>
                <link>https://polemic.nz/2019/04/08/te-kopuke/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20190408-TeKopuke_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2019/04/08/te-kopuke/</guid>
            </item>
        
            <item>
                <title>Auckland Cycleways</title>
                <description>&lt;p&gt;I&amp;#39;ve been working with some cycling data recently, and the good people at &lt;a href=&quot;https://www.bikeauckland.org.nz/project-watch-march-2019/&quot;&gt;Bike Auckland&lt;/a&gt; have asked if they can post a little map I made the other day. This is a quick look at
Aucklands cycling infrastructure as of March 2019, from the Auckland Transport
GIS &lt;a href=&quot;http://data-atgis.opendata.arcgis.com/&quot;&gt;open data portal&lt;/a&gt;. Check out the Bike Auckland
&lt;a href=&quot;https://www.bikeauckland.org.nz/project-watch-march-2019/&quot;&gt;blog post&lt;/a&gt; for an extended look at the state of cycling in Auckland today.&lt;/p&gt;

&lt;p&gt;(P.S &lt;em&gt;yes&lt;/em&gt; it has been a &lt;em&gt;very long&lt;/em&gt; time since I&amp;#39;ve updated this blog - 3 and half years!
Time flies when you&amp;#39;re busy. I&amp;#39;m working on a few other maps related to cycling, and I&amp;#39;m looking
to launch a project around the upcoming local body elections in New Zealand. More on that
later!)&lt;/p&gt;

&lt;h3&gt;Datasources&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz/set/4702-nz-aerial-imagery/&quot;&gt;NZ Aerial Imagery&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz&quot;&gt;Other Base data layers&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://data-atgis.opendata.arcgis.com/datasets/cycle-facility-network&quot;&gt;Cycle Facility Network&lt;/a&gt; (Auckalnd Transport)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <pubDate>Tue, 02 Apr 2019 00:00:00 +1300</pubDate>
                <link>https://polemic.nz/2019/04/02/auckland-cycleways/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20190402-AucklandCycleways_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2019/04/02/auckland-cycleways/</guid>
            </item>
        
            <item>
                <title>Whau Flags</title>
                <description>&lt;p&gt;I&amp;#39;ve been working on a side project for the &lt;a href=&quot;http://whauthepeople.com/&quot; target=&quot;_blank&quot;&gt;Whau
Arts Festival&lt;/a&gt; happening in Avondale, Auckland from the 15&lt;sup&gt;th&lt;/sup&gt; - 18&lt;sup&gt;th&lt;/sup&gt; October.
&amp;quot;&lt;a href=&quot;http://whauflags.nz/&quot; target=&quot;_blank&quot;&gt;Whau Flags&lt;/a&gt;&amp;quot; is an interactive installation (online
at &lt;a href=&quot;http://whauflags.nz/&quot; target=&quot;_blank&quot;&gt;whauflags.nz&lt;/a&gt; and via screens at the festival) that
generates flag designs. The site gives participants ways to interact with the installation by
guiding the evolution of new designs, saving and sharing favourites and more. It&amp;#39;s still under construction but usable now.&lt;/p&gt;

&lt;p&gt;Each flag is represented by a genome that defines the colour palette and constituent patterns that make
up the design. For example, the flag &lt;code&gt;356o560oCA0-5113o3125o3446-&lt;/code&gt; looks like this:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://whauflags.nz/flag/show/356o560oCA0-5113o3125o3446-/&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;/assets/images/flag-356o560oCA0-5113o3125o3446-.png&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From a flag page in the website, you can click the &amp;#39;evolve&amp;#39; button to produce new variants. Each
&amp;#39;allele&amp;#39; of the flag genome can mutate, migrate or disappear entirely in a generation. Some of the
results are surprising:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://whauflags.nz/flag/show/DCAoB72-9449o9112-/&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;/assets/images/flag-DCAoB72-9449o9112-.png&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&amp;#39;m looking forward to see how people use the site, and it&amp;#39;s possible that a local sewing group
will be &amp;quot;materializing&amp;quot; some of the designs as real life flags to fly at the event.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://whauflags.nz/flag/show/B13o5B0oCB1-1883o4551o7886-/&quot; target=&quot;_blank&quot;&gt;
    &lt;img src=&quot;/assets/images/flag-B13o5B0oCB1-1883o4551o7886-.png&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The festival itself is only in its second year, but it provides a platform for
alternative and experimental projects. There will be live metal-working, tattoo, 
a boy-racer chauffeur &amp;#39;experience&amp;#39; (for lack of a better description), experimental
architecture, large scale street art and a lot more. Hope to see you there!&lt;/p&gt;
</description>
                <pubDate>Fri, 25 Sep 2015 00:00:00 +1200</pubDate>
                <link>https://polemic.nz/2015/09/25/whauflag/</link>
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/09/25/whauflag/</guid>
            </item>
        
            <item>
                <title>Of Suburbs and Open Data Barriers</title>
                <description>&lt;p&gt;This is a a follow-up to my first &lt;a href=&quot;/2015/01/23/auckland-suburbs-part-1/&quot;&gt;Auckland Suburbs&lt;/a&gt; map.
As I outlined earlier, the only authoritative suburbs dataset for New Zealand is the 
&lt;a href=&quot;https://data.govt.nz/datasetrequest/show/4&quot;&gt;NZ Localities&lt;/a&gt; dataset. 
The data is maintained by the New Zealand Fire Service
Commission (NZFSC) and has been the subject of one of the longest running OIA disputes in NZ. &lt;/p&gt;

&lt;p&gt;In this post I expand a bit more on the background of the data and demonstrate why the NZFSC&amp;#39;s
licensing approach has proven counter-productive to their aims.&lt;/p&gt;

&lt;h3&gt;Localities and Suburbs&lt;/h3&gt;

&lt;p&gt;What is the NZ localities dataset? As follows:&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The data stored in the dataset describes the boundaries between different ‘localities’, 
or parts of the entire country. It might be understood as describing the boundaries between 
suburbs, but this would not be accurate as many ‘localities’ are not suburbs of a town or city, 
and public perceptions of where one suburb starts and another ends may differ from the 
boundaries defined in the dataset.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;While a locality is not &lt;em&gt;technically&lt;/em&gt; a suburb - it certainly comprises &lt;em&gt;of&lt;/em&gt; suburbs as we would
commonly understand them to be. And indeed, this is how the data is commonly used. &lt;/p&gt;

&lt;p&gt;The NZFSC has stated&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; that:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The NZ Localities dataset is available for distribution, and NZ Fire Service promote 
the use of this dataset as all emergency services are using the data for reference 
and to support emergency response. The dataset is managed and maintained by a 
consortium including NZ Fire Service, NZ Post and Quotable Value NZ.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;On the face of it, this is superb. It is a localities dataset, produced in
partnership with our postal service and local authorities, available for &lt;em&gt;free&lt;/em&gt; and ostensibly
promoted for further use as an authoritative reference.&lt;/p&gt;

&lt;h3&gt;Putting up Barriers&lt;/h3&gt;

&lt;p&gt;Unfortunately there is a big catch. While free, the data is distributed under a 
license agreement with NZFSC as licensor. The license can not be transferred
and can be terminated at any time.&lt;/p&gt;

&lt;p&gt;It also prevents the following uses:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;You may not incorporate the data into a project in such a way that
someone can extract the data,&lt;/li&gt;
&lt;li&gt;You may not modify the data, aside from text formatting and geographic re-projections,&lt;/li&gt;
&lt;li&gt;You may not sell, lease or otherwise provide the data for commercial gain.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Finally, the license requires that you update your copy of the data (and any copies you&amp;#39;ve
supplied to others who have signed the license) within 6 months of release of an update.&lt;/p&gt;

&lt;p&gt;Unfortunately, that makes the data unsuitable for a wide range of projects. Just a few reasons include:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Incompatibility with licenses associated with existing projects or products,&lt;/li&gt;
&lt;li&gt;Unclear who the license is granted to (does every contributor to an open source project have to sign it before they can see the data?),&lt;/li&gt;
&lt;li&gt;Termination clauses that might be difficult to adhere to,&lt;/li&gt;
&lt;li&gt;Difficulty in preventing &amp;#39;reverse engineering&amp;#39; of the data.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Perhaps most significantly, it cannot be incorporated into &lt;a href=&quot;http://openstreetmap.org&quot;&gt;Open Street Map&lt;/a&gt; - the same geographic data used in Auckland Transport&amp;#39;s &lt;a href=&quot;https://at.govt.nz/bus-train-ferry/journey-planner/&quot;&gt;Journey Planner&lt;/a&gt; site (and transport apps), &lt;a href=&quot;https://www.mapbox.com/showcase/&quot;&gt;these things&lt;/a&gt;, &lt;a href=&quot;http://wiki.openstreetmap.org/wiki/List_of_OSM-based_services&quot;&gt;all of these&lt;/a&gt;, pops up in
&lt;a href=&quot;https://en.wikipedia.org/wiki/OpenStreetMap#Commercial_services&quot;&gt;Apple maps&lt;/a&gt; and so on.&lt;/p&gt;

&lt;h3&gt;Why are the license terms so restrictive?&lt;/h3&gt;

&lt;p&gt;As the NZFSC puts it&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In our view there is a very clear risk to public safety where, the 
caller provides the call taker with address information based on a 
repackaged, on-sold dataset that contains unauthorised changes or does 
not include authorised updates.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The argument has some merit. They&amp;#39;ve spent a lot of time creating
an accurate locality dataset to ensure they get where they need to be; lives and
property are at risk and it&amp;#39;s important to avoid mistakes by maintaining control. This
logic ultimately convinced the Ombudsman that the NZFSC had a case to retain the license.&lt;/p&gt;

&lt;p&gt;The Ombudsman acknowledge a key objection, that&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;..the constraints placed on the use or manipulation of the dataset by the NZFSC 
licence has the effect of inhibiting more widespread adoption of the locality boundaries. 
This, in turn, increases the risk that someone may give a call centre an account of their 
location that differs from the call centre software — increasing the risk of delay in 
dispatching the correct equipment and people to the right location.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;But ultimately decided that:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;NZFSC’s willingness to provide the NZ Localities dataset free of charge, to anyone who 
seeks it and is willing to become a licensee, largely satisfies the public interest in 
disclosure of this information. In light of the potential for harm arising from 
out-of-date datasets in the public domain, I do not consider the licence requirement 
for updating the dataset when requested, to be onerous.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The reality of the situation is that other datasets &lt;em&gt;already&lt;/em&gt; exist in the public domain.&lt;/p&gt;

&lt;h3&gt;Put up a barriers and the community will route around you&lt;/h3&gt;

&lt;p&gt;The argument for retaining the license is predicated on the axiom that the NZFSC &lt;em&gt;has&lt;/em&gt; control.&lt;/p&gt;

&lt;p&gt;In the absence of a &lt;em&gt;facts about the world&lt;/em&gt; that can be used freely, the community can and 
does create its own. The data they produce is a mix of community consensus, guesswork, 
approximations and bad assumptions. The result is a lot of conflicting
locality information. The &lt;a href=&quot;http://nominatim.openstreetmap.org/&quot;&gt;Nominatum Open Street Map address finder&lt;/a&gt; includes non-existent&lt;a href=&quot;#footnotes&quot;&gt;&lt;sup&gt;4.&lt;/sup&gt;&lt;/a&gt; localities such as
&lt;a href=&quot;http://nominatim.openstreetmap.org/search.php?q=rosebank%2C+auckland&amp;viewbox=27.99%2C-26.11%2C28.09%2C-26.17&quot;&gt;Rosebank&lt;/a&gt; and &lt;a href=&quot;http://nominatim.openstreetmap.org/search.php?q=balmoral%2C+auckland&amp;viewbox=174.74%2C-36.88%2C174.84%2C-36.94&quot;&gt;Balmoral&lt;/a&gt; in Auckland. &lt;a href=&quot;https://mapzen.com/blog/who-s-on-first&quot;&gt;MapZen&amp;#39;s world gazetteer&lt;/a&gt; project will 
use open sources like &lt;a href=&quot;http://www.geonames.org/&quot;&gt;Geonames&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;captioned-image&quot;&gt;
    &lt;img src=&quot;/assets/maps/20150910-Quattroshapes.png&quot; /&gt;
    &lt;p class=&quot;caption&quot;&gt;Quattroshapes Neighbourhoods of Auckland &amp;mdash; Data CC-BY Foursquare / LINZ, Map CC-BY Hamish Campbell&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;Another example (displayed above) is the &lt;a href=&quot;http://quattroshapes.com/&quot;&gt;Quattroshapes&lt;/a&gt; gazetteer 
dataset created by &lt;a href=&quot;https://foursquare.com/&quot;&gt;Foursquare&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;To improve recommendations, we have created an authoritative source 
of polygons around a curated list of places. This gazetteer of 
non-overlapping polygons provides more relevant results than simple point geometries.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;A quick inspection reveals omissions (Kelston), additions (Balmoral)
and significant errors (no Rosebank, but the area is split between 4 incorrect locations).
In the absence of authoritative open data, this is what is often used to create real consumer products.&lt;/p&gt;

&lt;p class=&quot;pop&quot;&gt;The net result of restrictive licensing is to promote the use of inaccurate, non-authoritative and poor quality alternatives.&lt;/p&gt;

&lt;p&gt;I believe the NZFSC is genuinely concerned with ensuring that up-to-date information
is used in critical applications. The only way to achieve that aim is to release the data
under an open license.&lt;/p&gt;

&lt;h3&gt;The Ombudsman&amp;#39;s Decision&lt;/h3&gt;

&lt;p&gt;The original OIA request went all the way to the Ombudsman. Over 7 years after the original
OIA request the Ombudsman &lt;a href=&quot;http://www.ombudsman.parliament.nz/system/paperclip/document_files/document_files/885/original/179451_-_request_for_nz_localities_dataset.pdf?1413915614&quot;&gt;ruled in favour of NZFSC&amp;#39;s opinion&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This decision is a reminder that the Official Information Act is not a replacement for Open Data
or the &lt;a href=&quot;https://www.ict.govt.nz/guidance-and-resources/open-government/new-zealand-government-open-access-and-licensing-nzgoal-framework/&quot;&gt;NZGOAL&lt;/a&gt; framework in New Zealand.&lt;/p&gt;

&lt;p&gt;There was a glimmer of hope in the decision. Part 98 states:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In 2011 the NZFSC gave a public undertaking to review the licence agreement against the
criteria of the NZGOAL framework. NZFS has now confirmed, by letter of 24 July 2014,
that:&lt;/p&gt;

&lt;p&gt;“Since 2013, NZFS has been working with the NZ Geospatial Office (NZGO)
and LINZ to establish and mandate the NZ Localities dataset as a fundamental
dataset for NZ under the NZ Geospatial Strategy and NZGOAL framework.
NZFS is also working with NZGO and LINZ to establish the NZFS Commission as
the authoritative custodian of the NZ Localities dataset. ... Prior to the end of
2014, and subsequent to establishing NZFS as custodian, NZFS will release the
NZ Localities dataset under a new Creative Commons licence (CC variation yet
to be defined).”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It&amp;#39;s disappointing that nearing the end of 2015 we still haven&amp;#39;t seen the data released.&lt;/p&gt;

&lt;h3&gt;Moving forward&lt;/h3&gt;

&lt;p&gt;The final part of this series will:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Provide a methodology for generating the authoritative boundaries from open data sources, and&lt;/li&gt;
&lt;li&gt;Outline some of things that are happening to make an official localities dataset a
reality.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;&lt;span id=&quot;footnotes&quot;&gt;Footnotes&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;sup&gt;1.&lt;/sup&gt; &lt;a href=&quot;http://www.ombudsman.parliament.nz/system/paperclip/document_files/document_files/885/original/179451_-_request_for_nz_localities_dataset.pdf?1413915614&quot;&gt;Request for the New Zealand Localities
dataset - Ombudsman&amp;#39;s Decision - Page 2&lt;/a&gt;&lt;br&gt;
&lt;sup&gt;2.&lt;/sup&gt; ibid. Page 3&lt;br&gt;
&lt;sup&gt;3.&lt;/sup&gt; ibid. Page 8&lt;br&gt;
&lt;sup&gt;4.&lt;/sup&gt; Non-existent in that they don&amp;#39;t exist in the NZFSC data, but &lt;em&gt;are&lt;/em&gt; commonly known.&lt;/p&gt;
</description>
                <pubDate>Thu, 10 Sep 2015 00:00:00 +1200</pubDate>
                <link>https://polemic.nz/2015/09/10/suburbs-and-open-data-barriers/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20150910-AucklandSuburbs-Part2_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/09/10/suburbs-and-open-data-barriers/</guid>
            </item>
        
            <item>
                <title>Red Peak</title>
                <description>&lt;p&gt;A lot has already been said about our flag selection process. I&amp;#39;m
one of many that believe the selection panel dropped the ball at the final hurdle. Despite the 
&lt;a href=&quot;https://www.govt.nz/browse/engaging-with-government/the-nz-flag-your-chance-to-decide/gallery/?sort=random&quot;&gt;huge number of submissions&lt;/a&gt;, and an adequately &lt;a href=&quot;https://www.govt.nz/browse/engaging-with-government/the-nz-flag-your-chance-to-decide/gallery/&quot;&gt;promising long-list&lt;/a&gt;, &lt;a href=&quot;https://www.govt.nz/browse/engaging-with-government/the-nz-flag-your-chance-to-decide/the-four-alternatives&quot;&gt;the final four&lt;/a&gt; leave a lot
to be desired.&lt;/p&gt;

&lt;p&gt;Since the four designs were announced, there has been a groundswell of support for an alternative: &amp;quot;&lt;a href=&quot;https://www.govt.nz/browse/engaging-with-government/the-nz-flag-your-chance-to-decide/gallery/design/24310&quot;&gt;Red Peak&lt;/a&gt;&amp;quot; Aaron Dustin.
&lt;a href=&quot;http://www.nzherald.co.nz/opinion/news/article.cfm?c_id=466&amp;objectid=11507494&quot;&gt;Toby Manhire&lt;/a&gt; and &lt;a href=&quot;http://rowansimpson.com/2015/09/02/dear-john/&quot;&gt;Rowan Simpson&lt;/a&gt; make good arguments for why it should be considered.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Red-Peak-FINAL.jpg&quot; alt=&quot;Read Peak by Aaron Dustin&quot;&gt;&lt;/p&gt;

&lt;p&gt;It has simplicity and symbolism. It references our history, our people and our geography. &lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; lang=&quot;en&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;&lt;a href=&quot;https://twitter.com/hashtag/RedPeak?src=hash&quot;&gt;#RedPeak&lt;/a&gt; What do you see? &lt;a href=&quot;http://t.co/6i7BgXHZ5X&quot;&gt;pic.twitter.com/6i7BgXHZ5X&lt;/a&gt;&lt;/p&gt;&amp;mdash; Rick on Point (@RickOnPnt) &lt;a href=&quot;https://twitter.com/RickOnPnt/status/640148228562784256&quot;&gt;September 5, 2015&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;There is little chance the short-list will be changed, but the fact that so many have spontaneously
swung in behind this flag is hugely promising for its future. There will be more opportunities to
change the flag, after all. Let&amp;#39;s try this one on for size for a bit.&lt;/p&gt;
</description>
                <pubDate>Sun, 06 Sep 2015 00:00:00 +1200</pubDate>
                <link>https://polemic.nz/2015/09/06/nz-red-peak/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20150906-NZRedPeak_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/09/06/nz-red-peak/</guid>
            </item>
        
            <item>
                <title>Rivers of New Zealand</title>
                <description>&lt;p&gt;New Zealand&amp;#39;s &lt;a href=&quot;http://www.mfe.govt.nz/&quot;&gt;Ministry for the Environment&lt;/a&gt; recently launched their 
new &lt;a href=&quot;https://data.mfe.govt.nz/&quot;&gt;Data Service&lt;/a&gt;. It&amp;#39;s another excellent
source of open data and a sign that the &amp;#39;open data dam&amp;#39; has truly burst.&lt;/p&gt;

&lt;p&gt;One of the most interesting datasets in the service is the New Zealand &amp;quot;River
Environment Classification&amp;quot; set.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The New Zealand River Environment Classification (REC) organizes information about the physical characteristics of New Zealand&amp;#39;s rivers. Individual river sections are mapped according to physical factors such as climate, source of flow for the river water, topography, and geology, and catchment land cover eg, forest, pasture or urban. Sections of river that have similar ecological characteristics can then be grouped together, no matter where they are.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I highly recommend you go read &lt;a href=&quot;http://fogonwater.com/blog/2015/03/inverse-topography-mapping-stream-order/&quot;&gt;Chris McDowall&amp;#39;s blog post&lt;/a&gt;
where he maps the data and provides some insight into its structure. Chris uses the stream &lt;em&gt;order&lt;/em&gt; (an indication of how
many upstream tributaries feed into a particular segment) which gives a fascinating insight into the structure of rivers. &lt;/p&gt;

&lt;p&gt;Incidentally, as a software developer, this dataset is also interesting in that it represents a directed tree graph, and there are lots
of graphing options we could use to explore the data in a &lt;em&gt;logical&lt;/em&gt; rather than &lt;em&gt;physical&lt;/em&gt; sense.&lt;/p&gt;

&lt;p&gt;The data also includes catchment information, and for each segment it provides the total cumulative catchment are for the segments 
tributaries. This is the field used for the river widths in the map above, weighted non-linearly so we can still see the smaller river segments (at least, in the larger download below). Labels are somewhat arbitrarily applied, to highly some of the large outlets.&lt;/p&gt;

&lt;h3&gt;Downloads&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/assets/maps/20150320-Rivers-Of-New-Zealand_Large.png&quot;&gt;2048x2897px Version of the map&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Data Sources&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data.mfe.govt.nz/search/?q=REC&quot;&gt;River Environment Classification&lt;/a&gt; (MfE)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz&quot;&gt;Coastlines and Lake Polygons&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://koordinates.com/layer/1720-new-zealand-250m-bathymetry-rainbow-2008/&quot;&gt;NZ 250m Bathymetry Rainbow&lt;/a&gt; (NIWA)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <pubDate>Fri, 20 Mar 2015 00:00:00 +1300</pubDate>
                <link>https://polemic.nz/2015/03/20/Rivers-Of-New-Zealand/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20150320-Rivers-Of-New-Zealand_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/03/20/Rivers-Of-New-Zealand/</guid>
            </item>
        
            <item>
                <title>World Hexes</title>
                <description>&lt;p&gt;Last hex map for a while, I promise! Strapped for time this week so I was lazy and
used the same method as the &lt;a href=&quot;/2015/02/20/nz-population-hexbin/&quot;&gt;previous map&lt;/a&gt;. This map uses a world country boundaries in a
decimal degrees projection (WSG84) with 2.5 degree edge (5 degree span) hexes.&lt;/p&gt;

&lt;p&gt;Creating the border effect in QGIS is straight-forward once you understand
how &amp;quot;symbol levels&amp;quot; work. The symbology for the layer is quite simple - a polygon fill
with a series of border outlines like so:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20150227-symbology.png&quot; alt=&quot;World Hex Symbology in QGIS&quot;&gt;&lt;/p&gt;

&lt;p&gt;By default, the full symbology for each feature will be drawn one by one, including
any overlaps. The end result looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20150227-bad-map.png&quot; alt=&quot;World Hex Symbology without Symbol Levels&quot;&gt;&lt;/p&gt;

&lt;p&gt;You can change how QGIS draws feature symbology to instead draw each symbol
&amp;#39;level&amp;#39; for all features in sequence. From the &amp;quot;Advanced&amp;quot; menu in the symbology dialog,
click &amp;quot;Symbol Levels&amp;quot; and tick the check-box &amp;quot;Enable symbol levels&amp;quot;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/20150227-symbol-levels.png&quot; alt=&quot;Enabling Symbol Levels in QGIS&quot;&gt;&lt;/p&gt;

&lt;p&gt;This is great for outlining related features, especially when you also stack categorised
symbolizers based on feature attributes, like in my previous &lt;a href=&quot;/2015/01/16/auckland-employment-centres/&quot;&gt;employment centers&lt;/a&gt; map.&lt;/p&gt;
</description>
                <pubDate>Fri, 27 Feb 2015 00:00:00 +1300</pubDate>
                <link>https://polemic.nz/2015/02/27/world-hexes/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20150227-HexWorld_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/02/27/world-hexes/</guid>
            </item>
        
            <item>
                <title>NZ Population Hexbins</title>
                <description>&lt;p&gt;I&amp;#39;ve been thinking a lot about hexbin maps lately, after an earlier
exploration of &lt;a href=&quot;/2015/01/16/auckland-employment-centres/&quot;&gt;employment centers&lt;/a&gt;.
In the previous map, I generated the hexbin with a QGIS plug-in and manually
fixed up coastal hexes in a very non-reproducible way.&lt;/p&gt;

&lt;p&gt;I since discovered that the &lt;a href=&quot;http://cartodb.com/&quot;&gt;CartoDB&lt;/a&gt; project have an open
repository of &lt;a href=&quot;https://github.com/CartoDB/cartodb-postgresql&quot;&gt;postgresql functions&lt;/a&gt;
which include functions for &lt;a href=&quot;https://github.com/CartoDB/cartodb-postgresql/blob/master/scripts-available/CDB_Hexagon.sql#L31&quot;&gt;generating hexagonal grids&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This makes it easy to create hexagonal grids in postgresql/postgis and automate the
process of creating land overlays for specific areas.&lt;/p&gt;

&lt;p&gt;First of all I grabbed the LINZ coastlines and islands polygon layer, simplified it considerably, removed some
of the smaller off-shore islands and loaded this into postgres as the table &lt;code&gt;land_cover&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;I then created a hexagonal grid with a side length of 10km that covers the entire extent of the coastline layer:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ST_SetSRID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CDB_HexagonGrid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ST_Extent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;&quot;geom&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extent&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;&quot;land_cover&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
            &lt;span class=&quot;mi&quot;&gt;2193&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;&quot;hexgrid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The next step is to remove the hexagons that don&amp;#39;t cover land. The follow query finds hexagons that
intersect with the land cover layer and contain at least 30% land. This factor is a somewhat arbitrary - 
I wanted it to be slightly optimistic about coverage:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hexgrid_cover&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hexgrid&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;land_cover&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ST_INTERSECTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ST_AREA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ST_INTERSECTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ST_AREA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(Note that since the area of each hexagon is constant, the &lt;code&gt;ST_AREA(a.geom)&lt;/code&gt; can be optimized out, but it&amp;#39;s
provided here for simplicity)&lt;/p&gt;

&lt;p&gt;The result is a hexagonal grid coverage for the country. I&amp;#39;ve uploaded a few nationwide hexbin sets I&amp;#39;ve generated
for the whole country as &lt;a href=&quot;https://github.com/hamishcampbell/nz-data/tree/master/hexbin&quot;&gt;geojson on GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For this particular map, I&amp;#39;ve taken the NZ meshblock data with &amp;#39;usually resident population&amp;#39; counts summed the totals
for the hexagonal intersections weighted by area. I won&amp;#39;t provide the detail here but:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Pre-calculate the area for each meshblock as a new column in the meshblock table.&lt;/li&gt;
&lt;li&gt;Create a new layer of &lt;a href=&quot;http://postgis.net/docs/ST_Intersection.html&quot;&gt;intersections&lt;/a&gt; between the meshblock layer and hexagons, including the hexagon ID, original meshblock area and population count.&lt;/li&gt;
&lt;li&gt;Calculate the new (sliced) meshblock area, and divide this by the original area to get the proportion.&lt;/li&gt;
&lt;li&gt;Multiply the proportional area by the original resident population count to get the weighted population.&lt;/li&gt;
&lt;li&gt;Sum the weighted population over each hexagon id and assign that to the relevant hexagon.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;Datasources&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data.linz.govt.nz/layer/1153-nz-coastlines-and-islands-polygons-topo-150k/&quot;&gt;NZ Coastlines and Islands Polygons&lt;/a&gt; (LINZ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.stats.govt.nz/browse_for_stats/people_and_communities/Geographic-areas/digital-boundary-files.aspx&quot;&gt;Statistics NZ Pattern Files&lt;/a&gt; (Statistics NZ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://nzdotstat.stats.govt.nz/wbos/Index.aspx&quot;&gt;Statistics NZ Tables&lt;/a&gt; (Statistics NZ)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <pubDate>Fri, 20 Feb 2015 00:00:00 +1300</pubDate>
                <link>https://polemic.nz/2015/02/20/nz-population-hexbin/</link>
                
                <enclosure url="https://polemic.nz/assets/maps/20150220-NZHexBinPop_Thumb.png" type="image/png" />
                
                
                
                <guid isPermaLink="true">https://polemic.nz/2015/02/20/nz-population-hexbin/</guid>
            </item>
        
    </channel>
</rss>